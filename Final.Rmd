---
title: "Final Project"
author: "Jack Schroeder"
date: "4/4/2019"
output:
  html_document:
    df_print: paged
  pdf_document: default
citation_package: natbib
bibliography: references.bib
---


```{r setup, include=FALSE, cache=TRUE}
knitr::opts_chunk$set(echo = TRUE)

# I only need tidyverse for the time being. Once I start replicating the figures, I will
# likely need some other libraries.

library(lfe)
library(stargazer)
library(tidyverse)

# Smith and Martin leave two data files in the Dataverse. Both of them contain the same
# data. Since I'm more familiar with reading in a csv file versus a dta file (and I
# want to limit the libraries called), I read in their csv data in as csv_data.

csv_data <- read_csv("Smith-Martin-Replication-Data/IRELAND-CANDIDATES.csv")

```


```{r data cleaning, echo=FALSE, cache=TRUE}

# Smith and Martin recode a lot of values before going into their analysis. I am going
# to translate this part of their work and leave the figures themselves for a later
# time.

csv_data <- csv_data %>% 

# The first mutate is a scalar value of whether a politician is a legacy. What are these
# values? pre_mp is equal to 1 if past family members were elected to the Dail
# (Ireland's) lower house. cablegacy is coded 1 if their direct predecessor served in
# cabinet. All other values on this scale are equal to 0.
  
  mutate(legacyscale = case_when(cablegacy == 1 ~ 2,
                                 pre_mp == 1 ~ 1,
                                 TRUE ~ 0),
  
# cwins is the number of times (including the current term) the candidate has won
# election to the Dail. est_age is the estimated age of each candidate (if unknown) or
# the actual age (which is found in age). This age is taken from when the candidate
# runs/wins for the first time. Presumably Smith and Martin wanted to see if these
# numbers are still influential on an exponential scale.

         cwins2 = cwins^2,
        est_age2 = est_age^2,
        age2 = age^2,

# Then we have to recode some values already in the dataset into groups. The first is
# a group of estimated ages. The next is recoding educode to new values. educode refers
# to the highest degree received. 1 is primary school, 2 is secondary school, 3 is 
# tertiary, 4 university, and 5 postgraduate. They recode tertiary and university to have
# the same value in educode2.

        agegroup = case_when(est_age > 29 ~ 1,
                             est_age > 39 ~ 2,
                             est_age > 49 ~ 3,
                             est_age > 59 ~ 4,
                             TRUE ~ 0),
        educode2 = case_when(educode == 2 ~ 1,
                             educode == 3 ~ 2,
                             educode == 4 ~ 2,
                             educode == 5 ~ 3,
                             TRUE ~ as.double(educode)),

# The next recode focuses on the Dail term. There had been 32 Dail terms by 2016, but 
# the current dataset only looks at them as the term number. Since these terms have
# varying lengths, recoding them into years may yield stronger results on legacy.

        dailyear = case_when(dail ==  1 ~ 1918 ,
                             dail ==  2 ~ 1921,
                             dail ==  3 ~ 1922,
                             dail ==  4 ~ 1923,
                             dail ==  5 ~ 1927,
                             dail ==  6  ~ 1927,
                             dail ==  7 ~ 1932,
                             dail ==  8 ~ 1933,
                             dail ==  9 ~ 1937,
                             dail ==  10 ~ 1938,
                             dail ==  11 ~ 1943,
                             dail ==  12 ~ 1944,
                             dail ==  13 ~ 1948,
                             dail ==  14 ~ 1951,
                             dail ==  15 ~ 1954,
                             dail ==  16 ~ 1957,
                             dail ==  17 ~ 1961,
                             dail ==  18 ~ 1965,
                             dail ==  19 ~ 1969,
                             dail ==  20 ~ 1973,
                             dail ==  21 ~ 1977,
                             dail ==  22 ~ 1981,
                             dail ==  23 ~ 1982,
                             dail ==  24 ~ 1982,
                             dail ==  25 ~ 1987,
                             dail ==  26 ~ 1989,
                             dail ==  27 ~ 1992,
                             dail ==  28 ~ 1997,
                             dail ==  29 ~ 2002,
                             dail ==  30 ~ 2007,
                             dail ==  31 ~ 2011,
                             dail ==  32 ~ 2016),

# Another large case_when recode here with assigning districts to regions 
# for Table 7.

        region = case_when(district == "Carlow Kildare" | district == "Carlow Kilkenny" | district == "Kildare" | district == "Kildare North" | district == "Kildare South" ~ "Carlow-Kildare-Kilkenny",
                           district == "Cavan" | district == "Cavan Monaghan" | district == "Monaghan" ~ "Cavan Monaghan",
                           district == "Clare" | district == "Clare Galway South" ~ "Clare-Galway",
                           district == "Cork Borough" | district == "Cork City" | district == "Cork City North" | district == "Cork City South" | district == "Cork East" | district == "Cork Mid" | district == "Cork North" | district == "Cork North Central" | district == "Cork North East" | district == "Cork North West" | district == "Cork South" | district == "Cork South Central" | district == "Cork South East" | district == "Cork South West" | district == "Cork West" ~ "Cork",
                           district == "Donegal" | district == "Donegal East" | district == "Donegal Leitrim" | district == "Donegal North East" | district == "Donegal South West" | district == "Donegal West" ~ "Donegal",
                           district == "Dublin Artane" | district == "Dublin Ballyfermot" | district == "Dublin Cabra" | district == "Dublin Central" | district == "Dublin Clontarf" | district == "Dublin County" | district == "Dublin County Mid" | district == "Dublin County North" | district == "Dublin County South" | district == "Dublin County West" | district == "Dublin Finglas" | district == "Dublin Mid West" | district == "Dublin North" | district == "Dublin North Central" | district == "Dublin North East" | district == "Dublin North West" | district == "Dublin Rathmines" | district == "Dublin South" | district == "Dublin South Central" | district == "Dublin South East" | district == "Dublin South West" | district == "Dublin Townships" | district == "Dublin West" | district == "Dun Laoghaire" | district == "Dun Laoghaire Rathdown" ~ "Dublin",
                           district == "Galway East" | district == "Galway North" | district == "Galway North East" | district == "Galway South" | district == "Galway West" ~ "Clare-Galway",
                           district == "Kerry North" | district == "Kerry North-West Limerick" | district == "Kerry South" ~ "Kerry",
                           district == "Laoighis Offaly" | district == "Leix Offaly" ~ "Laois-Offaly",
                           district == "Limerick" | district == "Limerick City" | district == "Limerick County" | district == "Limerick East" | district == "Limerick West" ~ "Limerick",
                           district == "Mayo" | district == "Mayo East" | district == "Mayo North" | district == "Mayo South" | district == "Mayo West" ~ "Mayo",
                           district == "Athlone Longford" | district == "Longford Westmeath" | district == "Meath" | district == "Meath East" | district == "Meath West" | district == "Meath Westmeath" | district == "Westmeath" ~ "Meath-Westmeath",
                           district == "Leitrim" | district == "Longford Roscommon" | district == "Roscommon" | district == "Roscommon Leitrim" | district == "Roscommon Leitrim South" | district == "Sligo" | district == "Sligo Leitrim" | district == "Sligo Leitrim North" ~ "Sligo-Leitrim-Roscommon",
                           district == "Tipperary" | district == "Tipperary North" | district == "Tipperary South" ~ "Tipperary",
                           TRUE ~ district),

# Smith and Martin also recode a few partyid values to a new vector named
# partyidsimple. The changes are minor. Christian Centrists are lumped in with
# the Christian Solidarity, Sinn Fein's workers' parties are lumped in with
# the other workers' parties, Independent Fianna Fail and Fine Gael are recoded
# into their larger counterparts, and some smaller parties are recoded into the
# value 30, which contains other minor parties and non-parties.

      partyidsimple = case_when(partyid == 9 ~ 8,
                                partyid == 14 ~ 15,
                                partyid == 11 ~ 1,
                                partyid == 12 ~ 2,
                                partyid == 16 ~ 30,
                                partyid == 18 ~ 30,
                                partyid == 23 ~ 30,
                                partyid == 26 ~ 30,
                                partyid == 16 ~ 30,
                                TRUE ~ as.double(partyid))) %>% 
  
# Lastly, Smith and Martin filter out results from before 1944. This
# is done to focus on the previous 20 Dails.
  
  filter(elecyear > 1943) %>% 

# Another thing needs to be taken care of first. There was an Irish 
# politician named James Dillon. He was an independent associated with
# the Fine Gael party for most of his career. Smith and Martin go to
# great lengths to make sure he is coded as FG throughout the entire
# dataset. This makes enough sense from a cursory glance of his electoral
# history: he was leader of FG from 1959-1965. I'll indulge the authors and
# recode him.

  mutate(party = case_when(name == "Dillon, James" ~ "FG",
                           TRUE ~ party),
         partyid = case_when(name == "Dillon, James" ~ 2,
                             TRUE ~ as.double(partyid)),
         govparty = case_when(name == "Dillon, James" & elecyear == 1948 ~ 1,
                              TRUE ~ as.double(govparty)),
         firstrun = case_when(cruns == 1 ~ 1,
                              TRUE ~ 0)) %>% 

# Smith and Martin combine some variables into new ones. I do the same using
# the unite function.
  
  unite("party_year", c("partyidsimple", "elecyear"), remove=FALSE) %>% 
  unite("dist_year", c("districtid", "elecyear"), remove=FALSE) %>% 
  unite("party_dail", c("partyidsimple", "dail"), remove=FALSE) %>% 
  unite("party_dist", c("partyid", "districtid"), remove=FALSE) %>% 
  unite("party_region", c("partyid", "region"), remove=FALSE) %>% 
  unite(party_dist_dail, c("partyid", "districtid", "dail"), remove=FALSE) %>% 
  unite(party_region_dail, c("partyid" , "region", "dail"), remove=FALSE)

# There are quite a few rejoins necessary here since some new variables are
# summary data (and some of those are conditional on other factors). I create
# new dataframes for them but will rejoin them back to csv_data after they are
# all created. 

first_age <- csv_data %>% 
  group_by(pid) %>% 
  mutate(first_age = min(est_age)) %>% 
  group_by(pid) %>% 
  summarize(first_age = min(first_age))

first_party <- csv_data %>% 
  group_by(pid) %>% 
  mutate(first_party = case_when(cruns == 1 ~ party,
                                 TRUE ~ "NA")) %>% 
  group_by(pid) %>% 
  summarize(first_party = min(first_party))

# I need to rejoin the data twice: one to create prelocal, one to
# create preseanad. These take the lowest values of whether a candidate
# held local office or was in the Seanad (presumably because the 
# minimum value will hold true for when the candidate first ran).

prelocal <- csv_data %>% 
  group_by(pid) %>% 
  summarize(prelocal = min(local))

preseanad <- csv_data %>% 
  group_by(pid) %>% 
  summarize(preseanad = min(seanad))

agefirst <- csv_data %>% 
  group_by(pid) %>% 
  summarize(agefirst = min(first_age))

prevwins <- csv_data %>% 
  mutate(prevwins = cwins) %>% 
  group_by(pid) %>% 
  mutate(prevwins = case_when(result == 1 ~ as.double(prevwins)-1,
                                 TRUE ~ as.double(prevwins))) %>% 
  group_by(pid) %>% 
  summarize(prevwins = min(prevwins))

csv_data <- csv_data %>% 
  full_join(., first_age, by = "pid") %>% 
   full_join(., first_party, by = "pid") %>%
   full_join(., prelocal, by = "pid") %>% 
   full_join(., preseanad, by = "pid") %>% 
   full_join(., agefirst, by = "pid") %>% 
   full_join(., prevwins, by = "pid") %>% 
   mutate(prevwins2 = prevwins^2)

```

## Replication

@data use Stata to create the 7 tables and 6 figures in the paper. As a result, my output does not perfectly match their paper cosmetically. That said, the results are the same (save that the graphs look a bit better and some of the regression numbers are ever so slightly off). @data  fail to include replication code to create Tables 1 or 2. Although I may try producing them on my own later, I am skipping them for now.

### Figures

```{r fig1, echo=FALSE, cache=TRUE}

f1_c <- csv_data %>% 
  count(legacyscale) %>% 
  mutate(per = n/sum(n),
         position = "Candidates") %>% 
  select(-n)

f1_td <- csv_data %>% 
  filter(result == 1) %>% 
  count(legacyscale) %>% 
  mutate(per = n/sum(n),
         position = "TDs") %>% 
  select(-n)

f1_gtd <- csv_data %>% 
  filter(result == 1, govparty == 1) %>% 
  count(legacyscale) %>% 
  mutate(per = n/sum(n),
         position = "Government TDs") %>% 
  select(-n)

f1_cm <- csv_data %>% 
  filter(cabappt == 1) %>% 
  count(legacyscale) %>% 
  mutate(per = n/sum(n),
         position = "Cabinet Ministers") %>% 
  select(-n)

f1 <- rbind(f1_c, f1_td, f1_gtd, f1_cm) %>% 
  mutate(Legacy = case_when(legacyscale == 0 ~ "Nonlegacy",
                            legacyscale == 1 ~ "Noncabinet legacy",
                            legacyscale == 2 ~ "Cabinet legacy")) %>% 
  select(-legacyscale)

f1$position <- as.factor(f1$position)

f1$position <- fct_relevel(f1$position, "Candidates", "TDs", "Government TDs", "Cabinet Ministers")

f1 %>% 
  ggplot(aes(x=reorder(position, -per), y=per, fill=Legacy)) +
  geom_bar(stat="identity", position="fill") +
  xlab("") +
  ylab("Percent") +
  ggtitle("Figure 1. Politician Legacy Proportions", subtitle = "In the Republic of Ireland, 1944-2016")

```

```{r fig2, echo=FALSE, cache=TRUE}

```

```{r fig3, echo=FALSE, cache=TRUE}

```

```{r fig4, echo=FALSE, cache=TRUE}

```

```{r fig5, echo=FALSE, cache=TRUE}

```

```{r fig6, echo=FALSE, cache=TRUE}

```

### Tables

```{r t3, echo=FALSE, warning=FALSE, cache=TRUE, results='asis'}

t3_1 <- felm(result ~ as.factor(legacyscale), csv_data)
t3_2 <- felm(result ~ as.factor(legacyscale) | party_year, csv_data)
t3_3 <- felm(result ~ as.factor(legacyscale) | dist_year, csv_data)
t3_4 <- felm(result ~ as.factor(legacyscale) + female + firstrun | party_year, csv_data)
t3_5 <- felm(result ~ as.factor(legacyscale) + female + firstrun | dist_year, csv_data)

stargazer(t3_1, t3_2, t3_3, t3_4, t3_5,
          title = "Table 3. The Electoral Advantage of Legacy: Election Result",
          type = 'html')

```

```{r t4, echo=FALSE, warning=FALSE, cache=TRUE, results='asis'}

t4_1 <- felm(quotashare ~ as.factor(legacyscale), csv_data)
t4_2 <- felm(quotashare ~ as.factor(legacyscale) | party_year, csv_data)
t4_3 <- felm(quotashare ~ as.factor(legacyscale) | dist_year, csv_data)
t4_4 <- felm(quotashare ~ as.factor(legacyscale) + female + firstrun | party_year, csv_data)
t4_5 <- felm(quotashare ~ as.factor(legacyscale) + female + firstrun | dist_year, csv_data)

stargazer(t4_1, t4_2, t4_3, t4_4, t4_5,
          title = "Table 4. The Electoral Advantage of Legacy: Share of Quota",
          type = 'html')

```

```{r t5, echo=FALSE, warning=FALSE, cache=TRUE, results='asis'}

t5_1 <- felm(cabappt ~ as.factor(legacyscale), csv_data)
t5_2 <- felm(cabappt ~ as.factor(legacyscale) | partyidsimple, csv_data)
t5_3 <- felm(cabappt ~ as.factor(legacyscale) | party_dail, csv_data)
t5_4 <- felm(cabappt ~ as.factor(legacyscale) + cwins + cwins2 | party_dail, csv_data)
t5_5 <- felm(cabappt ~ as.factor(legacyscale) + cwins + cwins2 + quotashare | party_dail, csv_data)

stargazer(t5_1, t5_2, t5_3, t5_4, t5_5,
          title = "Table 5. The Legacy Advantage in Cabinet Selection",
          type = 'html')

```

```{r t6, echo=FALSE, warning=FALSE, cache=TRUE, results='asis'}

t6_1 <- felm(cabappt ~ as.factor(legacyscale) + cwins + cwins2 + generation | party_dail, subset(csv_data, pre_mp == 1))
t6_2 <- felm(cabappt ~ as.factor(legacyscale) + cwins + cwins2 + samename | party_dail, subset(csv_data, pre_mp == 1))
t6_3 <- felm(cabappt ~ as.factor(legacyscale) + cwins + cwins2 + samedistrict | party_dail, subset(csv_data, pre_mp == 1))

stargazer(t6_1, t6_2, t6_3,
          title = "Table 6. Unpacking the Informational Advantage: Strength of the Dynasty?",
          type = 'html')

```

```{r t7, echo=FALSE, warning=FALSE, cache=TRUE, results='asis'}

t7_1 <- felm(cabappt ~ as.factor(legacyscale) | party_region_dail, csv_data)
t7_2 <- felm(cabappt ~ as.factor(legacyscale) + cwins + cwins2 | party_region_dail, csv_data)

stargazer(t7_1, t7_2,
          title = "Table 7. Unpacking the Informational Advantage: Party Strongholds?",
          type = 'html')

```


## References

It appears the reference format we normally use isn't entirely working for me yet. This will be fixed!